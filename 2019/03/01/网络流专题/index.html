<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="网络流例题"><meta name="keywords" content="网络流"><meta name="author" content="Tang"><meta name="copyright" content="Tang"><title>网络流例题 | TddTang's blog</title><link rel="shortcut icon" href="/T1.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.3.0'
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E7%BD%91%E7%BB%9C%E6%B5%81%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%AF%E4%BB%A5%E6%88%B3%E8%BF%99%E9%87%8C"><span class="toc-text"> 对于网络流的基础知识可以戳这里</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E6%A8%A1%E6%9D%BF%E9%A2%98%E7%9B%AE"><span class="toc-text"> 一,模板题目:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1p1343-%E5%9C%B0%E9%9C%87%E9%80%83%E7%94%9F"><span class="toc-text"> 1.P1343 地震逃生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2p2740-usaco42%E8%8D%89%E5%9C%B0%E6%8E%92%E6%B0%B4drainage-ditches"><span class="toc-text"> 2.[P2740 USACO4.2]草地排水Drainage Ditches</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E5%88%9D%E8%AF%86%E6%9C%80%E5%B0%8F%E5%89%B2"><span class="toc-text"> 二,初识最小割：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1p4001-icpc-beijing-2006%E7%8B%BC%E6%8A%93%E5%85%94%E5%AD%90"><span class="toc-text"> 1.[P4001 ICPC-Beijing 2006]狼抓兔子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2p1345-usaco54%E5%A5%B6%E7%89%9B%E7%9A%84%E7%94%B5%E4%BF%A1telecowmunication"><span class="toc-text"> 2.[P1345 USACO5.4]奶牛的电信Telecowmunication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3p1361-%E5%B0%8Fm%E7%9A%84%E4%BD%9C%E7%89%A9-%E6%9C%80%E5%A4%A7%E6%B5%81%E6%9C%80%E5%B0%8F%E5%89%B2"><span class="toc-text"> 3.P1361 小M的作物 (最大流最小割)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E6%8B%86%E7%82%B9%E8%A3%82%E7%82%B9"><span class="toc-text"> 三,拆点裂点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1p1231-%E6%95%99%E8%BE%85%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text"> 1.P1231 教辅的组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2p1402-%E9%85%92%E5%BA%97%E4%B9%8B%E7%8E%8B"><span class="toc-text"> 2.P1402 酒店之王</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3p2472-scoi2007%E8%9C%A5%E8%9C%B4%E7%95%A5%E9%9A%BE"><span class="toc-text"> 3.[P2472 SCOI2007]蜥蜴（略难）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4p2944-usaco09mar%E5%9C%B0%E9%9C%87%E6%8D%9F%E5%A4%B12earthquake-damage-2"><span class="toc-text"> 4.[P2944 USACO09MAR]地震损失2Earthquake Damage 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5p2764-%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96%E5%8E%9F%E5%9B%BE%E7%9A%84%E7%BB%93%E7%82%B9%E6%95%B0-%E6%96%B0%E5%9B%BE%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0"><span class="toc-text"> 5.P2764 最小路径覆盖问题（最小路径覆盖&#x3D;原图的结点数-新图的最大匹配数）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6p2765-%E9%AD%94%E6%9C%AF%E7%90%83%E9%97%AE%E9%A2%98"><span class="toc-text"> 6.P2765 魔术球问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D%E5%8C%88%E7%89%99%E5%88%A9%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="toc-text"> 四,二分图匹配(匈牙利&#x2F;网络流)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%8C%88%E7%89%99%E5%88%A9"><span class="toc-text"> 了解匈牙利有趣易懂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1p2756-%E9%A3%9E%E8%A1%8C%E5%91%98%E9%85%8D%E5%AF%B9%E6%96%B9%E6%A1%88%E9%97%AE%E9%A2%98"><span class="toc-text"> 1.P2756 飞行员配对方案问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2p2055-zjoi2009%E5%81%87%E6%9C%9F%E7%9A%84%E5%AE%BF%E8%88%8D"><span class="toc-text"> 2.[P2055 ZJOI2009]假期的宿舍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81dijkstra%E7%A8%A0%E5%AF%86%E5%9B%BEspfa%E7%A8%80%E7%96%8F%E5%9B%BE"><span class="toc-text"> 五,最小费用最大流（Dijkstra稠密图&#x2F;Spfa稀疏图）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1p4016-%E8%B4%9F%E8%BD%BD%E5%B9%B3%E8%A1%A1%E9%97%AE%E9%A2%98"><span class="toc-text"> 1.P4016 负载平衡问题</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://pic3.zhimg.com/80/v2-b43a88bcc54a88c0d79115912f9e9da6_1440w.jpg"></div><div class="author-info__name text-center">Tang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">66</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">30</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">9</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://pic4.zhimg.com/v2-3be4c4a1a3813954b0d8c236953ad7c6_r.jpg?source=1940ef5c)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">TddTang's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间轴</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">网络流例题</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-03-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%AE%97%E6%B3%95/%E4%B8%93%E9%A2%98/">专题</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">9.2k</span><span class="post-meta__separator">|</span><span>阅读时长: 49 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="对于网络流的基础知识可以戳这里"><a class="markdownIt-Anchor" href="#对于网络流的基础知识可以戳这里"></a> 对于网络流的基础知识可以<a target="_blank" rel="noopener" href="https://blog.csdn.net/txl199106/article/details/64441994">戳这里</a></h3>
<p>我就不多bb了，讲的没人家好，还可能讲错( ఠൠఠ )ﾉ</p>
<blockquote>
<h1 id="一模板题目"><a class="markdownIt-Anchor" href="#一模板题目"></a> 一,模板题目:</h1>
</blockquote>
<h3 id="1p1343-地震逃生"><a class="markdownIt-Anchor" href="#1p1343-地震逃生"></a> 1.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P1343">P1343 地震逃生</a></h3>
<h3 id="2p2740-usaco42草地排水drainage-ditches"><a class="markdownIt-Anchor" href="#2p2740-usaco42草地排水drainage-ditches"></a> 2.[P2740 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2740">USACO4.2]草地排水Drainage Ditches</a></h3>
<p>*<strong>模板题就不贴代码了*</strong></p>
<blockquote>
<h1 id="二初识最小割"><a class="markdownIt-Anchor" href="#二初识最小割"></a> 二,初识最小割：</h1>
</blockquote>
<p>如果你对最小割了解的仅仅只是一个概念(最小割=最大流)，那你可以看一下以下几张图帮你更加了解一下。</p>
<p><img src="https://img-blog.csdnimg.cn/20190301103108637.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RERF9NYXN0ZXI=,size_16,color_FFFFFF,t_70" alt="" /></p>
<p><img src="https://img-blog.csdnimg.cn/20190301103119600.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RERF9NYXN0ZXI=,size_16,color_FFFFFF,t_70" alt="" /></p>
<p>几张图了解网络流的割是个什么东西…:所谓网络流的割就是将点划分为连到S与连到T的两个点集合…割就是这两个点集相连的边…但注意…割的容量只记从S点集到T点集的…T点集到S点集的不算…所以割的容量等于这从S点集到T点集所有边的容量之和…而网络流的最小割就是这些割中容量最小的…</p>
<h3 id="1p4001-icpc-beijing-2006狼抓兔子"><a class="markdownIt-Anchor" href="#1p4001-icpc-beijing-2006狼抓兔子"></a> 1.[P4001 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P4001">ICPC-Beijing 2006]狼抓兔子</a></h3>
<p><strong>思路</strong>：裸题 最小割。vector存边dinic可能过不了，不是T最后一个点就是MLE，如果有用vector写的可以交流一下ε(┬┬﹏┬┬)3(一定是评测机的问题)</p>
<h3 id="2p1345-usaco54奶牛的电信telecowmunication"><a class="markdownIt-Anchor" href="#2p1345-usaco54奶牛的电信telecowmunication"></a> 2.[P1345 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P1345">USACO5.4]奶牛的电信Telecowmunication</a></h3>
<p><strong>思路</strong>：初步认识拆点，将求最小割点变成求最小割。将一个点拆成出点和入点，然后两点之间连边的权值是1，这样跑最小割，他割的是这条边实际是这个点。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e3</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,c1,c2;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m&gt;&gt;c1&gt;&gt;c2;<span class="comment">//除了起始点外，全部拆点</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i!=c1 &amp;&amp; i!=c2)	add(i,i+n,<span class="number">1</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">int</span> a,b;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123; </span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		<span class="keyword">if</span>(a!=c1 &amp;&amp; a!=c2)	add(a+n,b,inf);</span><br><span class="line">		<span class="keyword">else</span>	add(a,b,inf);</span><br><span class="line">		<span class="keyword">if</span>(b!=c1 &amp;&amp; b!=c2)	add(b+n,a,inf);</span><br><span class="line">		<span class="keyword">else</span>	add(b,a,inf);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;dinic(c1,c2)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h3 id="3p1361-小m的作物-最大流最小割"><a class="markdownIt-Anchor" href="#3p1361-小m的作物-最大流最小割"></a> 3.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P1361">P1361 小M的作物 (最大流最小割)</a></h3>
<p><strong>思路</strong>：最小割就是花最少的力气使得所有的点分成两个集合，我们将A地看出源点s，B地看成汇点t，每个植物都可能向某一块地做出贡献，即A地向1有一条边，1向B有一条边。要选出一条边作为割边隔断。还有就是组合的情况了，新开一个点，s点指向新点为A贡献，新点指向他集合的点权值都为inf(使其不可能成为割边)，B同理，答案就是收益总和-最小割(割掉的就是不要的收益)，具体建图方式见图。</p>
<p><img src="https://img-blog.csdnimg.cn/20190301104119783.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RERF9NYXN0ZXI=,size_16,color_FFFFFF,t_70" alt="" /></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,k; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">	<span class="keyword">int</span> tp,s=n+<span class="number">1</span>,t=n+<span class="number">2</span>,a,b,cnt=n+<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)	<span class="built_in">cin</span>&gt;&gt;tp,add(s,i,tp),sum+=tp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)	<span class="built_in">cin</span>&gt;&gt;tp,add(i,t,tp),sum+=tp;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;m;</span><br><span class="line">	<span class="keyword">while</span>(m--)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;k&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		sum+=a+b;</span><br><span class="line">		<span class="keyword">int</span> pa=++cnt,pb=++cnt;</span><br><span class="line">		add(s,pa,a),add(pb,t,b);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;++i)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			add(pa,tp,inf);</span><br><span class="line">			add(tp,pb,inf);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;sum-dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<blockquote>
<h1 id="三拆点裂点"><a class="markdownIt-Anchor" href="#三拆点裂点"></a> 三,拆点裂点</h1>
</blockquote>
<h3 id="1p1231-教辅的组成"><a class="markdownIt-Anchor" href="#1p1231-教辅的组成"></a> 1.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P1231">P1231 教辅的组成</a></h3>
<p><strong>思路</strong>：要保证1本书只和一本教材和一本答案配对，即通过一本书的流量为1，故将书本拆成两个点。书的左边放练习册，右边放答案(反着放也无所谓),源点，汇点搞一搞就行了。建图详见洛谷第一篇题解图片，我的编号和图不一样。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/cdd8dfe71977bcb7e4f93573b71d37b4.png" alt="" /></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(&#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(&#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n1,n2,n3;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; mp[maxn]; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n1&gt;&gt;n2&gt;&gt;n3;</span><br><span class="line">	<span class="keyword">int</span> tot=n1+n2+n3;</span><br><span class="line">	<span class="keyword">int</span> s=<span class="number">0</span>,t=tot*<span class="number">10</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n1;++i)	add(i,i+n1,<span class="number">1</span>); <span class="comment">//对书拆点 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n1*<span class="number">2</span>+<span class="number">1</span>;i&lt;=n1*<span class="number">2</span>+n2;++i)	add(s,i,<span class="number">1</span>); <span class="comment">//练习册 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=n1*<span class="number">2</span>+n2+<span class="number">1</span>;i&lt;=n1*<span class="number">2</span>+n2+n3;++i)	add(i,t,<span class="number">1</span>); <span class="comment">//答案 </span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> a,b,m;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;m;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		add(b+n1*<span class="number">2</span>,a,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;m;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;++i)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		add(a+n1,b+n1*<span class="number">2</span>+n2,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2p1402-酒店之王"><a class="markdownIt-Anchor" href="#2p1402-酒店之王"></a> 2.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P1402">P1402 酒店之王</a></h3>
<p><strong>思路</strong>：与上题相同。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,p,q;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;p&gt;&gt;q;</span><br><span class="line">	<span class="keyword">int</span> s=<span class="number">0</span>,t=(n+p+q)*<span class="number">6</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)	add(i,i+n,<span class="number">1</span>); <span class="comment">//人 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>+n*<span class="number">2</span>;i&lt;=n*<span class="number">2</span>+p;++i)	add(s,i,<span class="number">1</span>);	<span class="comment">//房 </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>+n*<span class="number">2</span>+p;i&lt;=q+n*<span class="number">2</span>+p;++i)	add(i,t,<span class="number">1</span>); <span class="comment">//菜</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> tp; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=p;++j)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			<span class="keyword">if</span>(tp==<span class="number">1</span>)	add(j+n*<span class="number">2</span>,i,<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=q;++j)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			<span class="keyword">if</span>(tp==<span class="number">1</span>)	add(i+n,j+n*<span class="number">2</span>+p,<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3p2472-scoi2007蜥蜴略难"><a class="markdownIt-Anchor" href="#3p2472-scoi2007蜥蜴略难"></a> 3.[P2472 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2472">SCOI2007]蜥蜴</a>（略难）</h3>
<p><strong>思路</strong>：开始正儿巴金的建模了，任何时刻不能有两只蜥蜴在同一个石柱上，这句话是句屁话。用流的方式去思考，如果我们跳过去的石柱有蜥蜴，如果能往外跳，那可以让他先流出去，反之，一起流不去回到原来位置或者换方向跳，将每个点拆成两个点，他们之间的权值就是，石头的高度h，因为路过h个之后，石头的高度就会变成0，从而不能再有蜥蜴通过了。在能跳出矩阵的石头，都给他们的出点连一条边到t，权值为inf，而在能互通的点也连一条inf的边，在有蜥蜴的地方，从s连一条权值为1的边，然后跑最大流就行了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> r,c,d;</span><br><span class="line"><span class="keyword">int</span> mp[<span class="number">25</span>][<span class="number">25</span>];</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">gid</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (x<span class="number">-1</span>)*c+y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">double</span> <span class="title">js</span><span class="params">(<span class="keyword">double</span> x1,<span class="keyword">double</span> y1,<span class="keyword">double</span> x2,<span class="keyword">double</span> y2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span>	(<span class="keyword">double</span>)<span class="built_in">sqrt</span>((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">double</span> len[<span class="number">25</span>][<span class="number">25</span>][<span class="number">25</span>][<span class="number">25</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;r&gt;&gt;c&gt;&gt;d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=r;++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=c;++j)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=r;++k)&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> t=<span class="number">1</span>;t&lt;=c;++t)&#123;</span><br><span class="line">					len[i][j][k][t]=js(i,j,k,t);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> s=<span class="number">0</span>,t=r*c*<span class="number">10</span>; </span><br><span class="line">	<span class="keyword">char</span> tp;</span><br><span class="line">	<span class="keyword">int</span> num;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=r;++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=c;++j)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			num=tp-<span class="string">&#x27;0&#x27;</span>; <span class="comment">//题目没说不超过10，但数据是不超过10的</span></span><br><span class="line">			add(gid(i,j),gid(i,j)+r*c,num); <span class="comment">//拆点，容量为高度 </span></span><br><span class="line">			<span class="keyword">if</span>(i+d&gt;r || i-d&lt;<span class="number">1</span> || j+d&gt;c || j-d&lt;<span class="number">1</span> )&#123;</span><br><span class="line">				add(gid(i,j)+r*c,t,inf); <span class="comment">//可以跳出去，向汇点连边 </span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> up=max(<span class="number">1</span>,i-d),low=min(i+d,r),le=max(j-d,<span class="number">1</span>),ri=min(c,j+d);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> k=up;k&lt;=low;++k)&#123; <span class="comment">//向可能跳出的点连边 </span></span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> t=le;t&lt;=ri;++t)&#123;</span><br><span class="line">					<span class="keyword">if</span>(len[i][j][k][t]&lt;=d)	add(gid(i,j)+r*c,gid(k,t),inf);</span><br><span class="line">				&#125; </span><br><span class="line">			&#125; </span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=r;++i)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=c;++j)&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			<span class="keyword">if</span>(tp==<span class="string">&#x27;L&#x27;</span>)	add(s,gid(i,j),<span class="number">1</span>),sum++;	</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;sum-dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4p2944-usaco09mar地震损失2earthquake-damage-2"><a class="markdownIt-Anchor" href="#4p2944-usaco09mar地震损失2earthquake-damage-2"></a> 4.[P2944 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2944">USACO09MAR]地震损失2Earthquake Damage 2</a></h3>
<p><strong>思路</strong>：问题转化建模，拆点变成求最小割。题目就是说有些村庄不能到牛棚，而有些能到，那不就是将集合分成两个部分嘛，就是我们最少破坏几个村庄使得已知条件满足，就是拆点，求最小割（就是求最小割点p1345）。对于已经确定没坏但不能到达牛棚的点，我们给他的两点之间连inf，并且将它的出点连inf到t，因为他必不能到牛棚s(这点需注意)，起点和汇点也是确定的点，不能被割。而对于不确定的点就给他的两点之间连1.最后跑个最小割。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) 	<span class="keyword">return</span> f;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				e.cap -= d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> p,c,n;</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;p&gt;&gt;c&gt;&gt;n;</span><br><span class="line">	<span class="keyword">int</span> s=<span class="number">1</span>,t=p*<span class="number">10</span>,a,b;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=c;++i)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">		add(a+p,b,inf),add(b+p,a,inf); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line">		add(a,a+p,inf),vis[a]=<span class="number">1</span>;</span><br><span class="line">		add(a+p,t,inf);</span><br><span class="line">	&#125;</span><br><span class="line">	add(s,s+p,inf),add(s+p,s,inf);</span><br><span class="line">	add(t,t+p,inf),add(t+p,t,inf);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=p;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(!vis[i])	add(i,i+p,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h3 id="5p2764-最小路径覆盖问题最小路径覆盖原图的结点数-新图的最大匹配数"><a class="markdownIt-Anchor" href="#5p2764-最小路径覆盖问题最小路径覆盖原图的结点数-新图的最大匹配数"></a> 5.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2764">P2764 最小路径覆盖问题</a>（最小路径覆盖=原图的结点数-新图的最大匹配数）</h3>
<p><strong>思路</strong>：我们可以先认为每个点都是一个路径，我们每次将两条路径合并就会少一条路径，当然又向无环图，点只能在一条路径中出现，所以经过每个点的流量只能为1。将每个点拆点为出点和入点，s到每个出点的值为1，入点到t的值为1，保证每个点经过的流量为1，然后再给能到的点，连一下出点到入点(就是个二分图，出点在左，入点在右)，这样每个点都只能选一个方向流出，也只能选一个方向流入。我们每次在二分图里找一条匹配边就相当于把两条路径合成了一条路径，也就相当于路径数减少了1。所以找到了几条匹配边，路径数就减少了多少。所以有最小路径覆盖=原图的结点数-新图的最大匹配数，这是一个定理，不理解但要记住。输出路径的话，我们只需要知道头头，然后记录下一个。还有就是这题前向星，比vector快10倍。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//两种代码</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data) memset(_data,0,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> nxt[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; head;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dep[maxn], arc[maxn];</span><br><span class="line"><span class="keyword">bool</span> vis[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">-1</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;q;</span><br><span class="line">	q.push(s);</span><br><span class="line">	dep[s]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> v;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		v=q.front();</span><br><span class="line">		q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=eg[v][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[e.to]==<span class="number">-1</span>) &#123;</span><br><span class="line">				dep[e.to]=dep[v]+<span class="number">1</span>;</span><br><span class="line">				q.push(e.to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (v==t) &#123;</span><br><span class="line">		<span class="keyword">return</span> f;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=arc[v]; i&lt;(<span class="keyword">int</span>)eg[v].size(); ++i) &#123;</span><br><span class="line">		edge &amp;e=eg[v][i];</span><br><span class="line">		<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dep[v]+<span class="number">1</span>==dep[e.to]) &#123;</span><br><span class="line">			d=dfs(e.to,t,min(f, e.cap));</span><br><span class="line">			<span class="keyword">if</span> (d&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				nxt[v]=e.to; <span class="comment">//存一下当前节点的下一个</span></span><br><span class="line">				<span class="keyword">if</span>(v!=s)	vis[e.to-n]=<span class="number">1</span>; <span class="comment">//不是头节点，置为1</span></span><br><span class="line">				</span><br><span class="line">				e.cap-=d;</span><br><span class="line">				eg[e.to][e.rev].cap+=d;</span><br><span class="line">				<span class="keyword">return</span> d;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		bfs(s);</span><br><span class="line">		<span class="keyword">if</span> (dep[t]==<span class="number">-1</span>)	<span class="keyword">return</span> flow;</span><br><span class="line">		<span class="built_in">memset</span>(arc,<span class="number">0</span>,<span class="keyword">sizeof</span>(arc));</span><br><span class="line">		<span class="keyword">while</span> ((d=dfs(s,t,inf))&gt;<span class="number">0</span>) &#123;</span><br><span class="line">			flow+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</span><br><span class="line">	s=<span class="number">0</span>,t=n*<span class="number">10</span>;</span><br><span class="line">	<span class="keyword">int</span> x,y;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		add(s,i,<span class="number">1</span>),add(i+n,t,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		add(x,y+n,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ans=n-dinic(s,t);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		<span class="keyword">if</span>(!vis[i]) &#123; <span class="comment">//是头节点，就一直输出到尾</span></span><br><span class="line">			<span class="keyword">int</span> now=i;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;now&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">			<span class="keyword">while</span>(nxt[now] &amp;&amp; nxt[now]!=t)&#123;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;nxt[now]-n&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">				now=nxt[now]-n;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> dep[maxn],hd[maxn],cur[maxn],cnt=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="keyword">bool</span> vis[maxn]; </span><br><span class="line"><span class="keyword">int</span> nxt[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,nxt,c;</span><br><span class="line">&#125; eg[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[++cnt]=edge&#123;t,hd[f],w&#125;,hd[f]=cnt;</span><br><span class="line">	eg[++cnt]=edge&#123;f,hd[t],<span class="number">0</span>&#125;,hd[t]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	dep[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty())	q.pop();</span><br><span class="line">	q.push(s),dep[s]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> now,to;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		now=q.front(),q.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=hd[now]; i; i=eg[i].nxt) &#123;</span><br><span class="line">			to=eg[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!dep[to] &amp;&amp; eg[i].c&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				dep[to]=dep[now]+<span class="number">1</span>;</span><br><span class="line">				q.push(to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dep[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v==t)	<span class="keyword">return</span> flow;</span><br><span class="line">	<span class="keyword">int</span> to,tp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=cur[v]; i; i=eg[i].nxt)&#123;</span><br><span class="line">		to=eg[i].to;</span><br><span class="line">		<span class="keyword">if</span>(eg[i].c&gt;<span class="number">0</span> &amp;&amp; dep[to]==dep[v]+<span class="number">1</span>)&#123;</span><br><span class="line">			tp=dfs(to,t,min(flow,eg[i].c));</span><br><span class="line">			<span class="keyword">if</span>(tp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				nxt[v]=to;</span><br><span class="line">				<span class="keyword">if</span>(v!=s)	vis[to-n]=<span class="number">1</span>;</span><br><span class="line">				</span><br><span class="line">				eg[i].c-=tp,eg[i^<span class="number">1</span>].c+=tp;</span><br><span class="line">				<span class="keyword">return</span> tp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(bfs(s,t))&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	cur[i]=hd[i];  </span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">int</span> tp=dfs(s,t,inf))	flow+=tp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</span><br><span class="line">	s=<span class="number">0</span>,t=n*<span class="number">10</span>;</span><br><span class="line">	<span class="keyword">int</span> x,y;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		add(s,i,<span class="number">1</span>),add(i+n,t,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=m; ++i) &#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line">		add(x,y+n,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ans=n-dinic(s,t);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		<span class="keyword">if</span>(!vis[i]) &#123;</span><br><span class="line">			<span class="keyword">int</span> now=i;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;now&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">			<span class="keyword">while</span>(nxt[now] &amp;&amp; nxt[now]!=t)&#123;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;nxt[now]-n&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">				now=nxt[now]-n;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6p2765-魔术球问题"><a class="markdownIt-Anchor" href="#6p2765-魔术球问题"></a> 6.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2765">P2765 魔术球问题</a></h3>
<p><strong>思路</strong>：此题就是上题的变种。就是一堆数，然后他们有的数之间有平方的关系(有边)，然后你用最小路径覆盖，路径就是柱子，知道最小路径覆盖=原图的结点数-新图的最大匹配数，这个我们是知道的。点我们一个一个的加，每次加都给他的入点和t连权值为1的边，s和出点连边。然后在给可以和他组成平方数的点之间连一条权值为1的边，跑最大流，得到最小路径数如果大于柱子数，那就直接停了，而且我们知道最大的数是比现在这个数小1.再用上面的方法输出路径。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> dep[maxn],hd[maxn],cur[maxn],cnt=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> num,p=<span class="number">10000</span>,nxt[maxn];</span><br><span class="line"><span class="keyword">bool</span> pd[maxn],vis[maxn];</span><br><span class="line"><span class="keyword">int</span> s,t;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,nxt,c;</span><br><span class="line">&#125; eg[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[++cnt]= &#123;t,hd[f],w&#125;,hd[f]=cnt;</span><br><span class="line">	eg[++cnt]= &#123;f,hd[t],<span class="number">0</span>&#125;,hd[t]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=s; i&lt;=t; ++i)	dep[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty())	q.pop();</span><br><span class="line">	q.push(s),dep[s]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> now,to;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		now=q.front(),q.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=hd[now]; i; i=eg[i].nxt) &#123;</span><br><span class="line">			to=eg[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!dep[to] &amp;&amp; eg[i].c&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				dep[to]=dep[now]+<span class="number">1</span>;</span><br><span class="line">				q.push(to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dep[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v==t)	<span class="keyword">return</span> flow;</span><br><span class="line">	<span class="keyword">int</span> to,tp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=cur[v]; i; i=eg[i].nxt) &#123;</span><br><span class="line">		to=eg[i].to;</span><br><span class="line">		<span class="keyword">if</span>(eg[i].c&gt;<span class="number">0</span> &amp;&amp; dep[to]==dep[v]+<span class="number">1</span>) &#123;</span><br><span class="line">			tp=dfs(to,t,min(flow,eg[i].c));</span><br><span class="line">			<span class="keyword">if</span>(tp&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				nxt[v]=to;</span><br><span class="line">				<span class="keyword">if</span>(v!=s)	vis[to-p]=<span class="number">1</span>;</span><br><span class="line">				eg[i].c-=tp,eg[i^<span class="number">1</span>].c+=tp;</span><br><span class="line">				<span class="keyword">return</span> tp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">1</span>; ; ++i) &#123;</span><br><span class="line">		add(s,i,<span class="number">1</span>),add(i+p,t,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;i; ++j) &#123;</span><br><span class="line">			<span class="keyword">if</span>(pd[i+j])	add(j,i+p,<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span>(bfs(s,t)) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=s; i&lt;=t; ++i)	cur[i]=hd[i];</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">int</span> tp=dfs(s,t,inf))	flow+=tp;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(i-flow&gt;num)	<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;i<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;i; ++j) &#123;</span><br><span class="line">		<span class="keyword">if</span>(!vis[j]) &#123;</span><br><span class="line">			<span class="keyword">int</span> now=j;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;now&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">			<span class="keyword">while</span>(nxt[now] &amp;&amp; nxt[now]!=t) &#123;</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;nxt[now]-p&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">				now=nxt[now]-p;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;num;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>; i*i&lt;maxn; ++i)	pd[i*i]=<span class="number">1</span>;</span><br><span class="line">	s=<span class="number">0</span>,t=<span class="number">100000</span>;</span><br><span class="line">	dinic(s,t);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h1 id="四二分图匹配匈牙利网络流"><a class="markdownIt-Anchor" href="#四二分图匹配匈牙利网络流"></a> 四,二分图匹配(匈牙利/网络流)</h1>
</blockquote>
<h3 id="了解匈牙利"><a class="markdownIt-Anchor" href="#了解匈牙利"></a> <a target="_blank" rel="noopener" href="https://blog.csdn.net/Arabic1666/article/details/79824390">了解匈牙利</a>有趣易懂</h3>
<p>二分图最大匹配 变种:(匹配数量)</p>
<ol>
<li>最小顶点覆盖 = 最大匹配数<br />
在二分图中求最少的点，让每条边都至少和其中的一个点关联，这就是：“二分图的最小顶点覆盖”<br />
二分图的最小顶点覆盖数=最大匹配数</li>
<li>最小路径覆盖 = 节点数（n）- 最大匹配数（m）<br />
用尽量少的不相交简单路径覆盖有向无环图(DAG)的所有顶点，这就是DAG图的最小路径覆盖问题<br />
DAG图的最小路径覆盖数 = 节点数（n）- 最大匹配数（m）</li>
<li>二分图最大独立集 = 节点数（n）- 最大匹配数（m）<br />
从无向图中的顶点中选出k个并且k个顶点之间互不相邻，最大的k就是最大独立集<br />
二分图的最大独立集数 = 节点数（n）- 最大匹配数（m）</li>
</ol>
<h3 id="1p2756-飞行员配对方案问题"><a class="markdownIt-Anchor" href="#1p2756-飞行员配对方案问题"></a> 1.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2756">P2756 飞行员配对方案问题</a></h3>
<p><strong>思路</strong>：二分图匹配裸题。也可以网络流搞一下，差不多的速度，但明显匈牙利更加好写。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//匈牙利</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">3e3</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">bool</span> mp[maxn][maxn],vis[maxn];</span><br><span class="line"><span class="keyword">int</span> match[maxn];</span><br><span class="line"><span class="keyword">int</span> k,m,n;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(mp[x][i] &amp;&amp; !vis[i])&#123;</span><br><span class="line">			vis[i]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(match[i]==<span class="number">0</span> || dfs(match[i],n))&#123;</span><br><span class="line">				match[i]=x;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span></span>&#123; </span><br><span class="line">	<span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">		ms(vis,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(dfs(i,n))	ans++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	ms(match,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;m&gt;&gt;n;</span><br><span class="line">	<span class="keyword">int</span> x,y;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y &amp;&amp; (x!=<span class="number">-1</span> &amp;&amp; y!=<span class="number">-1</span>))&#123;</span><br><span class="line">		mp[x][y-m]=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;solve(m,n)&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(match[i])	<span class="built_in">cout</span>&lt;&lt;match[i]&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;i+m&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//网络流</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> dep[maxn],hd[maxn],cur[maxn],cnt=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> match[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,nxt,c;</span><br><span class="line">&#125; eg[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[++cnt]=edge&#123;t,hd[f],w&#125;,hd[f]=cnt;</span><br><span class="line">	eg[++cnt]=edge&#123;f,hd[t],<span class="number">0</span>&#125;,hd[t]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	dep[i]=<span class="number">0</span>; </span><br><span class="line">	<span class="keyword">while</span>(!q.empty())	q.pop();</span><br><span class="line">	q.push(s),dep[s]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> now,to;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		now=q.front(),q.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=hd[now]; i; i=eg[i].nxt) &#123;</span><br><span class="line">			to=eg[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!dep[to] &amp;&amp; eg[i].c&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				dep[to]=dep[now]+<span class="number">1</span>;</span><br><span class="line">				q.push(to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dep[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v==t)	<span class="keyword">return</span> flow;</span><br><span class="line">	<span class="keyword">int</span> to,tp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=cur[v]; i; i=eg[i].nxt)&#123;</span><br><span class="line">		to=eg[i].to;</span><br><span class="line">		<span class="keyword">if</span>(eg[i].c&gt;<span class="number">0</span> &amp;&amp; dep[to]==dep[v]+<span class="number">1</span>)&#123;</span><br><span class="line">			tp=dfs(to,t,min(flow,eg[i].c));</span><br><span class="line">			<span class="keyword">if</span>(tp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(v!=s &amp;&amp; to!=t)	match[v]=to;</span><br><span class="line">				eg[i].c-=tp,eg[i^<span class="number">1</span>].c+=tp;</span><br><span class="line">				<span class="keyword">return</span> tp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(bfs(s,t))&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	cur[i]=hd[i]; </span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">int</span> tp=dfs(s,t,inf))	flow+=tp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;m&gt;&gt;n;</span><br><span class="line">	s=<span class="number">0</span>,t=m+n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> x,y;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)	add(s,i,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=m+<span class="number">1</span>;i&lt;=n+m;++i)	add(i,t,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y &amp;&amp; (x!=<span class="number">-1</span> &amp;&amp; y!=<span class="number">-1</span>))&#123;</span><br><span class="line">		add(x,y,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;dinic(s,t)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(match[i])	<span class="built_in">cout</span>&lt;&lt;i&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;match[i]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2p2055-zjoi2009假期的宿舍"><a class="markdownIt-Anchor" href="#2p2055-zjoi2009假期的宿舍"></a> 2.[P2055 <a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P2055">ZJOI2009]假期的宿舍</a></h3>
<p><strong>思路</strong>：讲两种建模方式吧。</p>
<p><em><strong>网络流建模</strong></em> ：对于每个点拆点(也可以认为一边是人，一边是床)，对于在校生，从他们的床连一条权值为1的边到汇点t，而对于不回家的在校生或者非校生(这些都是想要住学校的人)，从源点连一条权值为1的边到他们，同时不回家的在校生当然也可以睡自己床了，连一条到自己的床。然后就是认识的关系，i认识j就可以从i连一条到j的床的边。<br />
<em><strong>匈牙利建模</strong></em> ：不回家而且是在校生，mp[i][i]=1，可以和自己的床匹配。对于有关系的，不回家的在校生或者不是在校生，并且对方是在校生，建立mp[i][j]=1,此二分图要保证左边的人都需要床住，而右边的都有床才能匹配，否则建立的边就是无效的(不要床的你给他连边出来，可能就会多分配，对于没有床的，你连过来也可能多匹配)。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//网络流</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rg register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> dep[maxn],hd[maxn],cur[maxn],cnt=<span class="number">1</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,nxt,c;</span><br><span class="line">&#125; eg[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w)</span> </span>&#123;</span><br><span class="line">	eg[++cnt]=edge&#123;t,hd[f],w&#125;,hd[f]=cnt;</span><br><span class="line">	eg[++cnt]=edge&#123;f,hd[t],<span class="number">0</span>&#125;,hd[t]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	dep[i]=<span class="number">0</span>; </span><br><span class="line">	<span class="keyword">while</span>(!q.empty())	q.pop();</span><br><span class="line">	q.push(s),dep[s]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> now,to;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		now=q.front(),q.pop();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=hd[now]; i; i=eg[i].nxt) &#123;</span><br><span class="line">			to=eg[i].to;</span><br><span class="line">			<span class="keyword">if</span>(!dep[to] &amp;&amp; eg[i].c&gt;<span class="number">0</span>) &#123;</span><br><span class="line">				dep[to]=dep[now]+<span class="number">1</span>;</span><br><span class="line">				q.push(to);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dep[t];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> v,<span class="keyword">int</span> t,<span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v==t)	<span class="keyword">return</span> flow;</span><br><span class="line">	<span class="keyword">int</span> to,tp;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> &amp;i=cur[v]; i; i=eg[i].nxt)&#123;</span><br><span class="line">		to=eg[i].to;</span><br><span class="line">		<span class="keyword">if</span>(eg[i].c&gt;<span class="number">0</span> &amp;&amp; dep[to]==dep[v]+<span class="number">1</span>)&#123;</span><br><span class="line">			tp=dfs(to,t,min(flow,eg[i].c));</span><br><span class="line">			<span class="keyword">if</span>(tp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				eg[i].c-=tp,eg[i^<span class="number">1</span>].c+=tp;</span><br><span class="line">				<span class="keyword">return</span> tp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">dinic</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(bfs(s,t))&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	cur[i]=hd[i];  </span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">int</span> tp=dfs(s,t,inf))	flow+=tp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> n,m,s,t,T;</span><br><span class="line"><span class="keyword">int</span> sch[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">	<span class="keyword">int</span> tp;</span><br><span class="line">	<span class="keyword">while</span>(T--)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;n; </span><br><span class="line">		s=<span class="number">0</span>,t=n*<span class="number">2</span>+<span class="number">5</span>;</span><br><span class="line">		<span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123; <span class="comment">//在校生 </span></span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;sch[i];</span><br><span class="line">			<span class="keyword">if</span>(sch[i]==<span class="number">1</span>)	add(i+n,t,<span class="number">1</span>); </span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123; <span class="comment">//回家 </span></span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">			<span class="keyword">if</span>((tp==<span class="number">0</span> &amp;&amp; sch[i]==<span class="number">1</span>) || (sch[i]==<span class="number">0</span>))	add(s,i,<span class="number">1</span>),num++;</span><br><span class="line">			<span class="comment">//不回家而且是在校生 或者 不是在校生</span></span><br><span class="line">			<span class="keyword">if</span>(tp==<span class="number">0</span> &amp;&amp; sch[i]==<span class="number">1</span>)	add(i,i+n,<span class="number">1</span>);</span><br><span class="line">			<span class="comment">//不回家的在校生当然也可以睡自己床了	</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">				<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">				<span class="keyword">if</span>(tp==<span class="number">1</span> &amp;&amp; i!=j)	add(i,j+n,<span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> res=dinic(s,t);</span><br><span class="line">		<span class="keyword">if</span>(res&gt;=num)	<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;^_^&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">else</span>	<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;T_T&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		cnt=<span class="number">1</span>; </span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=s;i&lt;=t;++i)	hd[i]=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//匈牙利</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">3e2</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">bool</span> mp[maxn][maxn],vis[maxn];</span><br><span class="line"><span class="keyword">int</span> match[maxn];</span><br><span class="line"><span class="keyword">int</span> n,sch[maxn],back[maxn];</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">		<span class="keyword">if</span>(mp[x][i] &amp;&amp; !vis[i])&#123;</span><br><span class="line">			vis[i]=<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(match[i]==<span class="number">0</span> || dfs(match[i],n))&#123;</span><br><span class="line">				match[i]=x;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span></span>&#123; </span><br><span class="line">	<span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">		ms(vis,<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(dfs(i,n))	ans++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> T;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">	<span class="keyword">int</span> tp; </span><br><span class="line">	<span class="keyword">while</span>(T--)&#123;</span><br><span class="line">		<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">		<span class="keyword">int</span> tot=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)	<span class="built_in">cin</span>&gt;&gt;sch[i];	<span class="comment">//在校生 </span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;	<span class="comment">//回家 </span></span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;back[i];</span><br><span class="line">			<span class="keyword">if</span>(back[i]==<span class="number">0</span> &amp;&amp; sch[i]==<span class="number">1</span>)	mp[i][i]=<span class="number">1</span>;</span><br><span class="line">			<span class="comment">//不回家而且是在校生</span></span><br><span class="line">			<span class="keyword">if</span>((back[i]==<span class="number">0</span> &amp;&amp; sch[i]==<span class="number">1</span>) || sch[i]==<span class="number">0</span>)	tot++; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j)&#123;</span><br><span class="line">				<span class="built_in">cin</span>&gt;&gt;tp;</span><br><span class="line">				<span class="keyword">if</span>(tp==<span class="number">1</span> &amp;&amp; i!=j)&#123;</span><br><span class="line">					<span class="keyword">if</span>(((sch[i]==<span class="number">1</span> &amp;&amp; back[i]==<span class="number">0</span>) || sch[i]==<span class="number">0</span>) &amp;&amp; sch[j]==<span class="number">1</span>)	mp[i][j]=<span class="number">1</span>;</span><br><span class="line">					<span class="comment">//不回家而且是在校生或者不是在校生，并且对方是在校生 </span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">int</span> num=solve(n,n);</span><br><span class="line">		<span class="keyword">if</span>(num&gt;=tot) 	<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;^_^&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">else</span>	<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;T_T&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		ms(back,<span class="number">0</span>),ms(sch,<span class="number">0</span>),ms(mp,<span class="number">0</span>),ms(vis,<span class="number">0</span>),ms(match,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<blockquote>
<h1 id="五最小费用最大流dijkstra稠密图spfa稀疏图"><a class="markdownIt-Anchor" href="#五最小费用最大流dijkstra稠密图spfa稀疏图"></a> 五,最小费用最大流（Dijkstra稠密图/Spfa稀疏图）</h1>
</blockquote>
<h3 id="1p4016-负载平衡问题"><a class="markdownIt-Anchor" href="#1p4016-负载平衡问题"></a> 1.<a target="_blank" rel="noopener" href="https://www.luogu.org/problemnew/show/P4016">P4016 负载平衡问题</a></h3>
<p><strong>思路</strong>：最后都是一样的数量，那先将每一个仓库的数量先减去平均数，看看要往外搬出去多少个，搬进来多少个，源点s向每个是正值(假设现仓库为v)的仓库连一条权值为v的边，说明要从他这总共要流出v的流量，再对每个是负值的仓库(假设现仓库为-u)，连一条值为u的边到t，它差u的流量所以流出u的流量到t，说明它得到了u的流量。再对相邻的点连权值为inf的边。单位流量的费用为1.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spfa</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,cap,cost,rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; eg[maxn];</span><br><span class="line"><span class="keyword">int</span> dis[maxn],pre[maxn],preid[maxn];</span><br><span class="line"><span class="keyword">bool</span> inq[maxn];</span><br><span class="line"><span class="keyword">int</span> n,m,s,t;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)	pre[i]=preid[i]=inq[i]=<span class="number">0</span>,eg[i].clear();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w,<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	eg[f].pb(edge &#123;t,w,c,(<span class="keyword">int</span>)eg[t].size()&#125;);</span><br><span class="line">	eg[t].pb(edge &#123;f,<span class="number">0</span>,-c,(<span class="keyword">int</span>)eg[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> st)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)	dis[i]=inf;</span><br><span class="line">	dis[st]=<span class="number">0</span>,inq[st]=<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">	q.push(st);</span><br><span class="line">	<span class="keyword">int</span> u;</span><br><span class="line">	edge e;</span><br><span class="line">	<span class="keyword">while</span>(!q.empty()) &#123;</span><br><span class="line">		u=q.front(),q.pop();</span><br><span class="line">		inq[u]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)eg[u].size(); ++i) &#123;</span><br><span class="line">			e=eg[u][i];</span><br><span class="line">			<span class="keyword">if</span>(e.cap&gt;<span class="number">0</span> &amp;&amp; dis[e.to]&gt;dis[u]+e.cost) &#123;</span><br><span class="line">				dis[e.to]=dis[u]+e.cost, pre[e.to]=u, preid[e.to]=i;</span><br><span class="line">				<span class="keyword">if</span>(!inq[e.to]) &#123;</span><br><span class="line">					q.push(e.to);</span><br><span class="line">					inq[e.to]=<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">costflow</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> d;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		spfa(s);</span><br><span class="line">		<span class="keyword">if</span>(dis[t]==inf)	<span class="keyword">break</span>;</span><br><span class="line">		d=inf;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> v=t; v!=s; v=pre[v]) &#123;</span><br><span class="line">			d=min(d,eg[pre[v]][preid[v]].cap);</span><br><span class="line">		&#125;</span><br><span class="line">		flow+=d,cost+=d*dis[t];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> v=t; v!=s; v=pre[v]) &#123;</span><br><span class="line">			eg[pre[v]][preid[v]].cap-=d;</span><br><span class="line">			eg[v][eg[pre[v]][preid[v]].rev].cap+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">	<span class="keyword">int</span> sum=<span class="number">0</span>,ave;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)	<span class="built_in">cin</span>&gt;&gt;a[i],sum+=a[i];</span><br><span class="line">	ave=sum/n;</span><br><span class="line">	s=<span class="number">0</span>,t=n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		a[i]-=ave;</span><br><span class="line">		<span class="keyword">if</span>(a[i]&gt;<span class="number">0</span>)	add(s,i,a[i],<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(a[i]&lt;<span class="number">0</span>)	add(i,t,-a[i],<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span>(i==<span class="number">1</span>)	add(i,i+<span class="number">1</span>,inf,<span class="number">1</span>),add(i,n,inf,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span>	<span class="keyword">if</span>(i==n)	add(i,i<span class="number">-1</span>,inf,<span class="number">1</span>),add(i,<span class="number">1</span>,inf,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span>	add(i,i+<span class="number">1</span>,inf,<span class="number">1</span>),add(i,i<span class="number">-1</span>,inf,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	costflow(s,t);</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;cost&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//Dijkstra</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> il inline</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(_data,v) memset(_data,v,sizeof(_data))</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> ll inf=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> to, cap, cost, rev;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; G[maxn];</span><br><span class="line"><span class="keyword">int</span> dis[maxn],pre[maxn], prid[maxn],h[maxn];</span><br><span class="line"><span class="keyword">int</span> n,s,t;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)	pre[i]=prid[i]=h[i]=<span class="number">0</span>,G[i].clear();</span><br><span class="line">&#125; <span class="comment">//暂默认t坐标最大</span></span><br><span class="line"><span class="function">il <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> t,<span class="keyword">int</span> w,<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	G[f].pb(edge &#123;t,w,c,(<span class="keyword">int</span>)G[t].size()&#125;);</span><br><span class="line">	G[t].pb(edge &#123;f,<span class="number">0</span>,-c,(<span class="keyword">int</span>)G[f].size()<span class="number">-1</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">il <span class="keyword">bool</span> <span class="title">dijkstra</span><span class="params">(<span class="keyword">int</span> st)</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pdis</span> &#123;</span></span><br><span class="line">		<span class="keyword">int</span> p,val;</span><br><span class="line">		<span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> pdis &amp;pd) <span class="keyword">const</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> val&gt;pd.val;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)	dis[i]=inf;</span><br><span class="line">	dis[st]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">priority_queue</span>&lt;pdis&gt; q;</span><br><span class="line">	q.push(&#123;st,dis[st]&#125;);</span><br><span class="line">	<span class="keyword">int</span> now;</span><br><span class="line">	<span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">		now=q.top().p,q.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;(<span class="keyword">int</span>)G[now].size(); ++i) &#123;</span><br><span class="line">			edge &amp;e=G[now][i];</span><br><span class="line">			<span class="keyword">if</span> (e.cap&gt;<span class="number">0</span> &amp;&amp; dis[e.to]&gt;dis[now]+e.cost+h[now]-h[e.to]) &#123;</span><br><span class="line">				dis[e.to]=dis[now]+e.cost+h[now]-h[e.to];</span><br><span class="line">				pre[e.to]=now,prid[e.to]=i;</span><br><span class="line">				q.push(&#123;e.to,dis[e.to]&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dis[t]!=inf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> flow=<span class="number">0</span>,cost=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">costflow</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (dijkstra(s)) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=t; ++i)	h[i]+=dis[i];</span><br><span class="line">		<span class="keyword">int</span> d=inf;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> v=t; v!=s; v=pre[v])	d=min(d,G[pre[v]][prid[v]].cap);</span><br><span class="line">		flow+=d,cost+=d*h[t];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> v=t; v!=s; v=pre[v]) &#123;</span><br><span class="line">			G[pre[v]][prid[v]].cap-=d;</span><br><span class="line">			G[v][G[pre[v]][prid[v]].rev].cap+=d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a[maxn];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">	<span class="keyword">int</span> sum=<span class="number">0</span>,ave;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)	<span class="built_in">cin</span>&gt;&gt;a[i],sum+=a[i];</span><br><span class="line">	ave=sum/n;</span><br><span class="line">	s=<span class="number">0</span>,t=n+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">		a[i]-=ave;</span><br><span class="line">		<span class="keyword">if</span>(a[i]&gt;<span class="number">0</span>)	add(s,i,a[i],<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>(a[i]&lt;<span class="number">0</span>)	add(i,t,-a[i],<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">if</span>(i==<span class="number">1</span>)	add(i,i+<span class="number">1</span>,inf,<span class="number">1</span>),add(i,n,inf,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span>	<span class="keyword">if</span>(i==n)	add(i,i<span class="number">-1</span>,inf,<span class="number">1</span>),add(i,<span class="number">1</span>,inf,<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span>	add(i,i+<span class="number">1</span>,inf,<span class="number">1</span>),add(i,i<span class="number">-1</span>,inf,<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	costflow(s,t);</span><br><span class="line">	<span class="built_in">cout</span>&lt;&lt;cost&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Tang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://tddtang.top/2019/03/01/网络流专题/">http://tddtang.top/2019/03/01/网络流专题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://tddtang.top">TddTang's blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/">网络流</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2019/02/25/(CodeForce)%20Codeforces%20Round541/"><span>(CodeForces) Codeforces Round 541 (Div. 2) A,B,C,D,F</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true';
var verify = 'true' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'VmYg4zNcoBiByayjzKbzfTk2-gzGzoHsz',
  appKey:'rgMI6cE5lEaz58dzRL0CIzbV',
  placeholder:'巴拉巴拉巴...',
  avatar:'retro',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(https://pic4.zhimg.com/v2-3be4c4a1a3813954b0d8c236953ad7c6_r.jpg?source=1940ef5c)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2021 By Tang</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>